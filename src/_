#:lib/!.sh

#:lib/_.sh

#:lib/flag.sh

#:lib/color.sh

#:lib/ui.sh

#:lib/self.sh

#:lib/string.sh

#:lib/array.sh

#:lib/path.sh

#:lib/defer.sh

#:lib/temp.sh

#:lib/os.sh

#:lib/url.sh

#:lib/http.sh

#:lib/file.sh

#:lib/bin.sh

#:lib/git.sh

#:lib/src.sh

#:lib/deb.sh

#:lib/text.sh

#:lib/filetype.sh

#:lib/zip.sh

#:lib/misc.sh

if [[ ${UNDERSCORE_SOURCE:-} = true ]] || [[ "${BASH_SOURCE[0]}" = "$0" ]]; then
	#/help/

	declare -Ag _command=(
		['ask']='.ask'
		['available']='.available'
		['bin install']='bin.install'
		['bin run']='bin.run'
		['bin use']='bin.use'
		['bug']='.bug'
		['cry']='.cry'
		['deb add']='deb.add'
		['deb install']='deb.install'
		['deb installed']='deb.installed'
		['deb missings']='deb.missings'
		['deb uninstall']='deb.uninstall'
		['deb update']='deb.update'
		['deb using']='deb.using'
		['die']='.die'
		['enter']='src.enter'
		['expired']='misc.expired'
		['file install']='file.install'
		['filetype is']='filetype.is'
		['filetype mime']='filetype.mime'
		['hmm']='.hmm'
		['http get']='http.get'
		['http is']='http.is'
		['must']='.must'
		['os codename']='os.codename'
		['os dist']='os.dist'
		['os is']='os.is'
		['os virtual']='os.virtual'
		['run']='misc.run'
		['say']='.say'
		['self install']='self.install'
		['self name']='self.name'
		['self path']='self.path'
		['self']='self'
		['self version']='self.version'
		['should']='.should'
		['src install']='src.install'
		['src use']='src.use'
		['temp inside']='temp.inside'
		['text fix']='text.fix'
		['text unfix']='text.unfix'
		['ui calling']='.calling'
		['ui getting']='.getting'
		['ui notok']='.notok'
		['ui ok']='.ok'
		['ui running']='.running'
		['unzip']='zip.unpack'
		['url is']='url.is'
	)

	#:lib/app.sh

	.source() {
		echo "_SELF=$(self.path)"
		echo
		sed 's/^\t\t//' <<'EOF'
		#:lib/!.sh: .prelude+

		#:src/_.sh
EOF
	}

	.main() {
		if ! .interactive && [[ $# -eq 0 ]]; then
			.source
		else
			.init
			app.dispatch "$@"
		fi
	}

	.main "$@"
fi
